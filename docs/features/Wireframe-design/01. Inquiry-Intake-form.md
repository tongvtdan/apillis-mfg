Absolutely! Based on your **PRD v1.2**, **Tech Stack v1.0.0**, and the updated business logic that all intake types (Inquiry, RFQ, PO, Design Idea) are unified as **Projects** in Supabase, Iâ€™ve fully revised the **Inquiry Intake Form** to reflect:

- âœ… Unified `projects` table (not `rfqs`)
- âœ… `intake_type` field: `inquiry`, `rfq`, `po`, `design_idea`
- âœ… File uploads **or** external links (e.g., Google Drive, Dropbox, Onshape)
- âœ… Role-based behavior (Customer, Sales Rep)
- âœ… Supabase + React + TypeScript + Tailwind + DaisyUI alignment

---

# ğŸ–¼ï¸ **Screen 4: Inquiry Intake Portal (Public Form)**  
*Unified Entry Point for RFQ, PO, Design Idea, and General Inquiries*  
*Now maps to `projects` table in Supabase*

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          Submit Your Manufacturing Inquiry                                          â”‚
â”‚                                       Weâ€™ll review your request within 48 hours                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”˜ I'm submitting as a Customer  
ğŸ”˜ I'm a Sales Representative submitting on behalf of a customer  
     â†’ Stored in context: `userRole: 'customer' | 'sales_rep'`
     â†’ If "Sales Rep": show customer selector below
```

---

### ğŸ”¹ **Intake Type & Project Details**

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  PROJECT DETAILS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Intake Type*             â—‹ Inquiry        â—‹ RFQ        â—‹ PO        â—‹ Design Idea
                         â†’ If "Design Idea": show <div className="alert alert-info text-sm"> 
                            â€œThis will be reviewed by the Innovation Team. No quote will be generated.â€

Project Title*           [ High-Precision Sensor Mount                              ]
                         â†’ Required â€¢ Max 100 chars â€¢ zod: string().min(3).max(100)

Description*             [ Durable aluminum housing for industrial IoT sensors...   ]
                         â†’ Required â€¢ Min 50 chars â€¢ <textarea className="textarea textarea-bordered" />

Estimated Volume*        
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Quantity    â”‚ Unit            â”‚ Frequency        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ [ 5,000 ]   â”‚ [ pcs ]         â”‚ [ per year â–¼ ]   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†’ [+ Add Row] â†’ for multi-tier volumes (e.g., prototype + production)
                         â†’ Hidden if userRole === 'customer' (optional for internal use)
                         â†’ zod: array of { qty: number, unit: string, freq: enum }

Target Price (per unit)  [ $8.50 ]                                                  â†’ Currency: USD (auto)
                         â†’ Optional â€¢ <input type="number" step="0.01" />

Desired Delivery Date*   [ ğŸ“… Oct 15, 2025 ]                                        â†’ Min: +7 days â€¢ <input type="date" />

Project Reference        [ PO-2025-TECHNOVA-001 ]                                   â†’ Optional â€¢ Only shown if "PO" selected
```

> ğŸ’¡ **UI Behavior**:
> - `Intake Type` determines routing and scoring logic
> - Volume & Target Price used in **costing engine (FR-501)** only for RFQ/PO
> - `Project Reference` appears only when "PO" is selected

---

### ğŸ”¹ **Customer Information** *(Conditional Logic)*

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  CUSTOMER INFORMATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

#### Case 1: **Customer is Logged In**
```
Full Name*               [ Sarah Chen                                  ] âœ… (readonly)
Company*                 [ TechNova Inc.                               ] âœ… (from profile)
Email*                   [ sarah.chen@technova.com                     ] âœ…
Phone                    [ +1-555-123-4567                               ]
Country*                 [ United States â–¼ ]                             
â†’ Auto-filled from `profiles` table â€¢ Phone editable
```

#### Case 2: **New Customer (Anonymous)**
```
Full Name*               [ ____________________________________________ ]
Company*                 [ ____________________________________________ ]
Email*                   [ ____________________________________________ ] â†’ zod: email()
Phone                    [ ____________________________________________ ]
Country*                 [ ________________________ â–¼ ] â†’ ISO 3166-1 dropdown
â†’ All fields required â€¢ zod validation applied
```

#### Case 3: **Sales Representative Submitting**
```
Select Customer*         [ Search or select existing â–¼ ]
                         â†’ Autocomplete from `customers` table
                         â†’ If not found â†’ [ + Create New Customer ]

                         â†’ On select: auto-fills fields below
                         â†’ User can edit if needed
```

> ğŸ” **Supabase Tables**:
> - `contacts` â†’ id, name, email, phone, country, created_by
> - `users` â†’ user roles (RLS enforcement)
> - RLS: `sales_rep` can CRUD customers; `contact` can only see own

---

### ğŸ”¹ **Technical Documents & References**

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TECHNICAL DOCUMENTS & REFERENCES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ Upload files or paste links to cloud storage
   Supported: PDF, STEP, IGES, XLSX, DWG, SLDPRT, STL, ZIP (Max 10MB per file)

   [x] Engineering Drawings (2D/3D)     â†’ Sensor_Mount_Drawing.step âœ… (2.4 MB)
                                         â†’ OR Link: [ https://drive.google.com/... ] ğŸ”—
   [x] Bill of Materials (BOM)          â†’ BOM_SensorMount.xlsx âœ… (85 KB)
                                         â†’ OR Link: [ https://share.onshape.com/... ] ğŸ”—
   [ ] Quality Specifications           â†’ [ Upload ] OR [ Paste Link ]
   [ ] Compliance Docs (ISO, RoHS, etc.)â†’ [ Upload ] OR [ Paste Link ]
   [+] Add Another File or Link

âš ï¸  Required: At least one drawing and BOM must be provided (file or link).
    Tip: Use ZIP for multiple related files. For large assemblies, link to Onshape or Fusion 360.

    Notes: input notes for the projects
```

> ğŸ“ **Supabase Storage Rules**:
> - Bucket: `project-uploads`
> - Max file size: 10MB (enforced client + RLS)
> - Path: `project_uploads/{project_id}/`
> - Public URL generated after submit
> - Meta: `{ project_id, uploaded_by, file_type, source: 'upload' | 'link' }`

> ğŸ”— **Link Handling**:
> - Accepts: Google Drive, Dropbox, Onshape, Fusion 360, GrabCAD, etc.
> - Validated via regex or domain allowlist
> - Stored in `documents` table with `source_type: 'external'`, `url: string`

---

### ğŸ”¹ **Privacy & Submission**

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  PRIVACY & SUBMISSION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[âœ“] I agree to the Terms of Service and Privacy Policy
    â†’ Link opens <dialog className="modal"> with legal text (DaisyUI modal)

                      [Ã— Cancel]                           [Save as Draft]                     [Submit Inquiry â†’]
                                                                                               â†’ <button className="btn btn-primary loading" /> on submit
```

> ğŸ”„ **Save as Draft**:
> - Stores in `project_drafts` table (JSONB `form_data`)
> - Accessible via "My Drafts" page
> - TTL: 30 days (auto-purge)

> ğŸš€ **On Submit**:
> 1. Validate with `zod` schema
> 2. Insert into `projects` table (status: `inquiry`, intake_type: `'rfq' | 'po' | 'design_idea'`)
> 3. Auto-generate Project ID: `PRJ-2025-001` (via DB function)
> 4. Save files to `project-uploads` bucket **or** store external links in `documents` table
> 5. Trigger Edge Function: `send-inquiry-confirmation`
> 6. Redirect to `/project/submitted?prj=PRJ-2025-001`

---

## âœ… **Zod Validation Schema (TypeScript)**

```ts
// types/project.d.ts
import { z } from 'zod';

const volumeItemSchema = z.object({
  qty: z.number().positive(),
  unit: z.enum(['pcs', 'units', 'kits']),
  freq: z.enum(['per year', 'per month', 'per quarter', 'prototype', 'initial'])
});

const documentItemSchema = z.object({
  type: z.string(),
  file: z.instanceof(File).optional(),
  link: z.string().url().optional(),
  uploaded: z.boolean().optional()
}).refine(data => data.file || data.link, {
  message: "Either a file or a link is required"
});

export const inquiryFormSchema = z.object({
  intakeType: z.enum(['inquiry', 'rfq', 'po', 'design_idea']),
  projectTitle: z.string().min(3).max(100),
  description: z.string().min(50),
  volumes: z.array(volumeItemSchema).optional(),
  targetPrice: z.number().optional(),
  deliveryDate: z.string().refine(date => new Date(date) > new Date(Date.now() + 604800000)),
  projectReference: z.string().optional(), // Only for PO
  customerName: z.string().min(2),
  company: z.string().min(2),
  email: z.string().email(),
  phone: z.string().optional(),
  country: z.string().length(2),
  documents: z.array(documentItemSchema).min(2, "At least two items required: Drawing and BOM"),
  agreedToTerms: z.boolean().refine(val => val === true, "You must agree to the terms")
});

export type InquiryForm = z.infer<typeof inquiryFormSchema>;
```

---

## ğŸ§© **Supabase Data Model (Key Tables)**

| Table            | Purpose                                            |
| ---------------- | -------------------------------------------------- |
| `projects`       | Main project records (PRJ-2025-XXX)                |
| `documents`      | Files **and** external links (source: upload/link) |
| `contacts`       | Customer master data                               |
| `project_drafts` | JSONB storage for incomplete forms                 |
| `users`          | User roles and auth mapping                        |
| `activity_log`   | Immutable log of all actions (FR-803)              |

### `projects` Table Schema
```sql
id UUID PRIMARY KEY
project_id TEXT UNIQUE -- PRJ-2025-001
intake_type ENUM('inquiry', 'rfq', 'po', 'design_idea')
title TEXT
description TEXT
status TEXT DEFAULT 'inquiry'
volume JSONB
target_price NUMERIC
delivery_date DATE
project_reference TEXT
customer_id UUID REFERENCES customers(id)
created_by UUID REFERENCES auth.users
created_at TIMESTAMPTZ DEFAULT NOW()
```

---

## ğŸ¨ **DaisyUI + Tailwind Classes Used**

| Element          | Class                                                               |
| ---------------- | ------------------------------------------------------------------- |
| Card             | `card bg-base-100 shadow-md border border-gray-200`                 |
| Input            | `input input-bordered w-full`                                       |
| Textarea         | `textarea textarea-bordered min-h-24`                               |
| Button (Primary) | `btn btn-primary`                                                   |
| Button (Ghost)   | `btn btn-ghost`                                                     |
| Alert (Info)     | `alert alert-info shadow-sm`                                        |
| Modal            | `modal`, `modal-box`, `modal-action`                                |
| Dropzone         | `border-2 border-dashed border-base-300 rounded-lg p-6 text-center` |
| Link Field       | `input input-bordered input-sm pl-8` + ğŸ”— icon prefix                |

---

## âœ… **PRD & Tech Stack Alignment**

| PRD Feature                 | Implemented? | Notes                                     |
| --------------------------- | ------------ | ----------------------------------------- |
| FR-101 (Web Form + Uploads) | âœ…            | Now supports links too                    |
| FR-102 (Auto ID)            | âœ…            | `P-YYMMDDXX` via DB function              |
| FR-103 (Validate Docs)      | âœ…            | Requires drawing + BOM (file or link)     |
| FR-104 (Confirmation Email) | âœ…            | Edge Function `send-inquiry-confirmation` |
| FR-801 (Role-Based)         | âœ…            | Supabase Auth + RLS                       |
| FR-601/602 (Document Mgmt)  | âœ…            | Files + links in `documents` table        |
| Appendix 12.2 â€“ Templates   | âœ…            | Form fields mapped                        |
| Audit Trail (FR-803)        | âœ…            | Supabase activity logs                    |

