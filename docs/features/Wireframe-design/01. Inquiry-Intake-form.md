Absolutely! Based on your **PRD v1.2**, **Tech Stack v1.0.0**, and the updated business logic that all intake types (Inquiry, RFQ, PO, Design Idea) are unified as **Projects** in Supabase, I’ve fully revised the **Inquiry Intake Form** to reflect:

- ✅ Unified `projects` table (not `rfqs`)
- ✅ `intake_type` field: `inquiry`, `rfq`, `po`, `design_idea`
- ✅ File uploads **or** external links (e.g., Google Drive, Dropbox, Onshape)
- ✅ Role-based behavior (Customer, Sales Rep)
- ✅ Supabase + React + TypeScript + Tailwind + DaisyUI alignment

---

# 🖼️ **Screen 4: Inquiry Intake Portal (Public Form)**  
*Unified Entry Point for RFQ, PO, Design Idea, and General Inquiries*  
*Now maps to `projects` table in Supabase*

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          Submit Your Manufacturing Inquiry                                          │
│                                       We’ll review your request within 48 hours                                     │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

🔘 I'm submitting as a Customer  
🔘 I'm a Sales Representative submitting on behalf of a customer  
     → Stored in context: `userRole: 'customer' | 'sales_rep'`
     → If "Sales Rep": show customer selector below
```

---

### 🔹 **Intake Type & Project Details**

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  PROJECT DETAILS
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Intake Type*             ○ Inquiry        ○ RFQ        ○ PO        ○ Design Idea
                         → If "Design Idea": show <div className="alert alert-info text-sm"> 
                            “This will be reviewed by the Innovation Team. No quote will be generated.”

Project Title*           [ High-Precision Sensor Mount                              ]
                         → Required • Max 100 chars • zod: string().min(3).max(100)

Description*             [ Durable aluminum housing for industrial IoT sensors...   ]
                         → Required • Min 50 chars • <textarea className="textarea textarea-bordered" />

Estimated Volume*        
  ┌─────────────┬─────────────────┬──────────────────┐
  │ Quantity    │ Unit            │ Frequency        │
  ├─────────────┼─────────────────┼──────────────────┤
  │ [ 5,000 ]   │ [ pcs ]         │ [ per year ▼ ]   │
  └─────────────┴─────────────────┴──────────────────┘
                         → [+ Add Row] → for multi-tier volumes (e.g., prototype + production)
                         → Hidden if userRole === 'customer' (optional for internal use)
                         → zod: array of { qty: number, unit: string, freq: enum }

Target Price (per unit)  [ $8.50 ]                                                  → Currency: USD (auto)
                         → Optional • <input type="number" step="0.01" />

Desired Delivery Date*   [ 📅 Oct 15, 2025 ]                                        → Min: +7 days • <input type="date" />

Project Reference        [ PO-2025-TECHNOVA-001 ]                                   → Optional • Only shown if "PO" selected
```

> 💡 **UI Behavior**:
> - `Intake Type` determines routing and scoring logic
> - Volume & Target Price used in **costing engine (FR-501)** only for RFQ/PO
> - `Project Reference` appears only when "PO" is selected

---

### 🔹 **Customer Information** *(Conditional Logic)*

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  CUSTOMER INFORMATION
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
```

#### Case 1: **Customer is Logged In**
```
Full Name*               [ Sarah Chen                                  ] ✅ (readonly)
Company*                 [ TechNova Inc.                               ] ✅ (from profile)
Email*                   [ sarah.chen@technova.com                     ] ✅
Phone                    [ +1-555-123-4567                               ]
Country*                 [ United States ▼ ]                             
→ Auto-filled from `profiles` table • Phone editable
```

#### Case 2: **New Customer (Anonymous)**
```
Full Name*               [ ____________________________________________ ]
Company*                 [ ____________________________________________ ]
Email*                   [ ____________________________________________ ] → zod: email()
Phone                    [ ____________________________________________ ]
Country*                 [ ________________________ ▼ ] → ISO 3166-1 dropdown
→ All fields required • zod validation applied
```

#### Case 3: **Sales Representative Submitting**
```
Select Customer*         [ Search or select existing ▼ ]
                         → Autocomplete from `customers` table
                         → If not found → [ + Create New Customer ]

                         → On select: auto-fills fields below
                         → User can edit if needed
```

> 🔐 **Supabase Tables**:
> - `contacts` → id, name, email, phone, country, created_by
> - `users` → user roles (RLS enforcement)
> - RLS: `sales_rep` can CRUD customers; `contact` can only see own

---

### 🔹 **Technical Documents & References**

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  TECHNICAL DOCUMENTS & REFERENCES
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
📎 Upload files or paste links to cloud storage
   Supported: PDF, STEP, IGES, XLSX, DWG, SLDPRT, STL, ZIP (Max 10MB per file)

   [x] Engineering Drawings (2D/3D)     → Sensor_Mount_Drawing.step ✅ (2.4 MB)
                                         → OR Link: [ https://drive.google.com/... ] 🔗
   [x] Bill of Materials (BOM)          → BOM_SensorMount.xlsx ✅ (85 KB)
                                         → OR Link: [ https://share.onshape.com/... ] 🔗
   [ ] Quality Specifications           → [ Upload ] OR [ Paste Link ]
   [ ] Compliance Docs (ISO, RoHS, etc.)→ [ Upload ] OR [ Paste Link ]
   [+] Add Another File or Link

⚠️  Required: At least one drawing and BOM must be provided (file or link).
    Tip: Use ZIP for multiple related files. For large assemblies, link to Onshape or Fusion 360.

    Notes: input notes for the projects
```

> 📁 **Supabase Storage Rules**:
> - Bucket: `project-uploads`
> - Max file size: 10MB (enforced client + RLS)
> - Path: `project_uploads/{project_id}/`
> - Public URL generated after submit
> - Meta: `{ project_id, uploaded_by, file_type, source: 'upload' | 'link' }`

> 🔗 **Link Handling**:
> - Accepts: Google Drive, Dropbox, Onshape, Fusion 360, GrabCAD, etc.
> - Validated via regex or domain allowlist
> - Stored in `documents` table with `source_type: 'external'`, `url: string`

---

### 🔹 **Privacy & Submission**

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  PRIVACY & SUBMISSION
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
[✓] I agree to the Terms of Service and Privacy Policy
    → Link opens <dialog className="modal"> with legal text (DaisyUI modal)

                      [× Cancel]                           [Save as Draft]                     [Submit Inquiry →]
                                                                                               → <button className="btn btn-primary loading" /> on submit
```

> 🔄 **Save as Draft**:
> - Stores in `project_drafts` table (JSONB `form_data`)
> - Accessible via "My Drafts" page
> - TTL: 30 days (auto-purge)

> 🚀 **On Submit**:
> 1. Validate with `zod` schema
> 2. Insert into `projects` table (status: `inquiry`, intake_type: `'rfq' | 'po' | 'design_idea'`)
> 3. Auto-generate Project ID: `PRJ-2025-001` (via DB function)
> 4. Save files to `project-uploads` bucket **or** store external links in `documents` table
> 5. Trigger Edge Function: `send-inquiry-confirmation`
> 6. Redirect to `/project/submitted?prj=PRJ-2025-001`

---

## ✅ **Zod Validation Schema (TypeScript)**

```ts
// types/project.d.ts
import { z } from 'zod';

const volumeItemSchema = z.object({
  qty: z.number().positive(),
  unit: z.enum(['pcs', 'units', 'kits']),
  freq: z.enum(['per year', 'per month', 'per quarter', 'prototype', 'initial'])
});

const documentItemSchema = z.object({
  type: z.string(),
  file: z.instanceof(File).optional(),
  link: z.string().url().optional(),
  uploaded: z.boolean().optional()
}).refine(data => data.file || data.link, {
  message: "Either a file or a link is required"
});

export const inquiryFormSchema = z.object({
  intakeType: z.enum(['inquiry', 'rfq', 'po', 'design_idea']),
  projectTitle: z.string().min(3).max(100),
  description: z.string().min(50),
  volumes: z.array(volumeItemSchema).optional(),
  targetPrice: z.number().optional(),
  deliveryDate: z.string().refine(date => new Date(date) > new Date(Date.now() + 604800000)),
  projectReference: z.string().optional(), // Only for PO
  customerName: z.string().min(2),
  company: z.string().min(2),
  email: z.string().email(),
  phone: z.string().optional(),
  country: z.string().length(2),
  documents: z.array(documentItemSchema).min(2, "At least two items required: Drawing and BOM"),
  agreedToTerms: z.boolean().refine(val => val === true, "You must agree to the terms")
});

export type InquiryForm = z.infer<typeof inquiryFormSchema>;
```

---

## 🧩 **Supabase Data Model (Key Tables)**

| Table            | Purpose                                            |
| ---------------- | -------------------------------------------------- |
| `projects`       | Main project records (PRJ-2025-XXX)                |
| `documents`      | Files **and** external links (source: upload/link) |
| `contacts`       | Customer master data                               |
| `project_drafts` | JSONB storage for incomplete forms                 |
| `users`          | User roles and auth mapping                        |
| `activity_log`   | Immutable log of all actions (FR-803)              |

### `projects` Table Schema
```sql
id UUID PRIMARY KEY
project_id TEXT UNIQUE -- PRJ-2025-001
intake_type ENUM('inquiry', 'rfq', 'po', 'design_idea')
title TEXT
description TEXT
status TEXT DEFAULT 'inquiry'
volume JSONB
target_price NUMERIC
delivery_date DATE
project_reference TEXT
customer_id UUID REFERENCES customers(id)
created_by UUID REFERENCES auth.users
created_at TIMESTAMPTZ DEFAULT NOW()
```

---

## 🎨 **DaisyUI + Tailwind Classes Used**

| Element          | Class                                                               |
| ---------------- | ------------------------------------------------------------------- |
| Card             | `card bg-base-100 shadow-md border border-gray-200`                 |
| Input            | `input input-bordered w-full`                                       |
| Textarea         | `textarea textarea-bordered min-h-24`                               |
| Button (Primary) | `btn btn-primary`                                                   |
| Button (Ghost)   | `btn btn-ghost`                                                     |
| Alert (Info)     | `alert alert-info shadow-sm`                                        |
| Modal            | `modal`, `modal-box`, `modal-action`                                |
| Dropzone         | `border-2 border-dashed border-base-300 rounded-lg p-6 text-center` |
| Link Field       | `input input-bordered input-sm pl-8` + 🔗 icon prefix                |

---

## ✅ **PRD & Tech Stack Alignment**

| PRD Feature                 | Implemented? | Notes                                     |
| --------------------------- | ------------ | ----------------------------------------- |
| FR-101 (Web Form + Uploads) | ✅            | Now supports links too                    |
| FR-102 (Auto ID)            | ✅            | `P-YYMMDDXX` via DB function              |
| FR-103 (Validate Docs)      | ✅            | Requires drawing + BOM (file or link)     |
| FR-104 (Confirmation Email) | ✅            | Edge Function `send-inquiry-confirmation` |
| FR-801 (Role-Based)         | ✅            | Supabase Auth + RLS                       |
| FR-601/602 (Document Mgmt)  | ✅            | Files + links in `documents` table        |
| Appendix 12.2 – Templates   | ✅            | Form fields mapped                        |
| Audit Trail (FR-803)        | ✅            | Supabase activity logs                    |

