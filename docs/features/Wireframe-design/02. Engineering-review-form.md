# 🖼️ **Screen: Engineering Technical Review Form**  
*Internal Use Only | Part of RFQ Internal Review Workflow (FR-301, FR-303)*  
Aligned with: **PRD v1.2**, **Tech Stack v1.0.0**, **Supabase + React + TypeScript + Tailwind CSS + DaisyUI**

---

## 📌 Overview

This is the **Engineering Team’s Internal Review Form**, triggered after a new project (formerly RFQ) is submitted via the intake portal. It supports **FR-301 (structured digital review)**, **FR-303 (risk logging)**, and **FR-803 (audit trail)**.

All data is stored in the `internal_reviews` table with `department = 'engineering'`.

---

# 🖼️ **Text-Based Figma Design: Engineering Review Form**

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                            RFQ-25082001 – Engineering Review                                                       │
│                       Internal Assessment – For Engineering Team Use Only                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  FEASIBILITY ASSESSMENT
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
[ ] Design feasible as-is
[ ] Requires modification (specify):
    → [ Textarea: "Hole tolerances exceed standard CNC capabilities. Recommend increasing ±0.05mm to ±0.1mm." ]
[ ] Not feasible
    → [ If selected: show alert ] “This will halt the workflow. A justification is required.”

⚠️  Status auto-updates to "Needs Revision" if modifications are suggested.
```

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  TECHNICAL RISKS (Check all that apply)
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
[✓] Material availability         → Lead time: [ 8 weeks ▼ ] → Supplier risk: [ Medium ▼ ]
[✓] Tolerance stack-up            → Affected features: [ Holes A1-A4, B7 ]
[✓] Surface finish requirements   → Spec: [ Ra 0.8µm ▼ ] → Process: [ Precision grinding required ]
[ ] Part warpage (injection molding)
[ ] Tool wear (high-volume CNC)
[ ] Assembly interference
[ ] Other: _________________________
```

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  TOOLING & FIXTURES
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
[✓] Custom jig/fixture required
    → Description: "Alignment jig for welding sub-assembly"
    → Estimated hours: [ 40 ] 
[✓] Special tooling needed
    → Tool type: [ Form tool for internal thread ▼ ]
    → Notes: "Non-standard M12x0.75 internal thread requires custom tap"
[ ] None required

Estimated tooling cost: [ $2,850.00 ] → Currency: USD (auto)
→ Used in cost roll-up (FR-501)
```

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  DESIGN RECOMMENDATIONS
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Design improvements:
[ Consider simplifying the undercuts to reduce mold cost. 
  Current design requires 3-side core pulls; revised version could use 1-side. ]

Alternative materials:
[ 7075-T6 aluminum is difficult to source. Recommend 6061-T6 for prototype phase. ]

Process suggestions:
[ Use wire EDM for slot tolerances <±0.02mm instead of milling. ]
```

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  ATTACHMENTS & LINKS
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
📎 Attach revised drawings, simulations, or analysis reports
   [ Upload file or paste link ] → Supports: STEP, PDF, FEA results, ZIP (Max 10MB)

   → [ design_feedback_v2.pdf ] ✅ (1.2 MB)
   → [ https://onshape.com/documents/abc123 ] 🔗
```

```
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
  REVIEW METADATA
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Reviewer: [ James Wu (Lead Engineer) ] → Auto-filled from Supabase auth
Date: [ Sep 5, 2025 ] → Auto-filled (today)
Status: [ Draft ▼ ] → Options: Draft, Submitted, Rejected, Needs Revision
```

```
                      [ Save Draft ]                     [ Request Clarification ]                     [ Submit Review ]
                                                                                                     → Final action
```

---

## ✅ **PRD & Tech Stack Alignment**

| PRD Requirement                       | Implemented? | Notes                                            |
| ------------------------------------- | ------------ | ------------------------------------------------ |
| **FR-301** (Structured Review Form)   | ✅            | Digital checklist + free-text fields             |
| **FR-303** (Log Risks & Tooling)      | ✅            | Risk categories + cost tracking                  |
| **FR-304** (Request Clarification)    | ✅            | “Request Clarification” button triggers workflow |
| **FR-601/602** (Document Attachments) | ✅            | Files + links stored in `documents`              |
| **FR-803** (Audit Trail)              | ✅            | All actions logged in `audit_logs`               |
| **FR-501** (Cost Roll-Up)             | ✅            | Tooling cost flows to costing engine             |

---

## 🧩 **React Component Structure (Suggested)**

```tsx
// pages/EngineeringReviewPage.tsx
<ReviewLayout rfqId="RFQ-25082001" department="Engineering">
  <FeasibilitySection />
  <RiskAssessmentSection />
  <ToolingRequirementsSection />
  <RecommendationsSection />
  <AttachmentsUploader section="engineering" />
  <ReviewMetadata reviewer={user} status="draft" />
  <ReviewActions 
    onSaveDraft={handleSave}
    onRequestClarification={openClarificationModal}
    onSubmit={handleSubmit}
  />
</ReviewLayout>
```

---

## 🗂️ **Supabase Data Model**

### `internal_reviews` Table
```sql
id UUID PRIMARY KEY
project_id TEXT → references projects.project_id
department TEXT → 'engineering'
feasibility_status TEXT → 'feasible', 'requires_modification', 'not_feasible'
modification_notes TEXT
tooling_cost NUMERIC
status TEXT → 'draft', 'submitted', 'rejected', 'needs_revision'
reviewer_id UUID → references auth.users
created_at TIMESTAMPTZ DEFAULT NOW()
updated_at TIMESTAMPTZ
```

### `documents` Table (used for attachments)
```sql
id UUID PRIMARY KEY
project_id TEXT
section TEXT → 'engineering_review'
file_name TEXT
file_path TEXT → supabase storage path
url TEXT → external link
uploaded_by UUID
created_at TIMESTAMPTZ
```

### `audit_logs` Table (FR-803)
```sql
action: 'engineering_review_submitted'
user_id: UUID
project_id: TEXT
details: JSONB → { tooling_cost: 2850, risks: ['material_availability', 'tolerance_stack'] }
timestamp: TIMESTAMPTZ
```

---

## 🎨 **UI/UX & Tailwind Design System**

### **Styling Guide**
```tailwind
card: card bg-base-100 shadow-md border border-gray-200 p-6
section-title: font-semibold text-lg text-gray-800 border-b pb-3 mb-4
checkbox: checkbox checkbox-sm checked:bg-blue-600
textarea: textarea textarea-bordered w-full min-h-20
input: input input-bordered w-full
button-primary: btn btn-primary
button-secondary: btn btn-secondary
button-ghost: btn btn-ghost
alert-info: alert alert-info shadow-sm text-sm
```

### **DaisyUI Components Used**
- `<div class="card">`
- `<label class="label cursor-pointer">`
- `<input type="checkbox" class="checkbox">`
- `<textarea class="textarea">`
- `<select class="select">`
- `<div class="alert alert-info">`
- `<dialog class="modal">` (for clarification request)

---

## 🔐 **Role-Based Access Control (FR-801)**

| Role               | Permissions                                       |
| ------------------ | ------------------------------------------------- |
| `engineering`      | Can view, edit, submit engineering review         |
| `engineering_lead` | Can approve/reject reviews (if workflow requires) |
| `procurement`      | Read-only after submission                        |
| `supplier`         | No access                                         |
| `customer`         | No access                                         |

> 🔒 **RLS Policy (Supabase)**:
```sql
-- Only engineering team can insert/update their reviews
CREATE POLICY "Engineering team can manage their reviews"
ON internal_reviews
FOR ALL
USING (department = 'engineering' AND reviewer_id = auth.uid())
WITH CHECK (department = 'engineering' AND reviewer_id = auth.uid());
```

---

## ⚙️ **Validation & Workflow Logic**

| Field                | Validation Rule                                       |
| -------------------- | ----------------------------------------------------- |
| `feasibility_status` | Required                                              |
| `modification_notes` | Required if "requires modification"                   |
| `tooling_cost`       | Must be ≥ 0                                           |
| `status`             | Cannot submit if "not feasible" without justification |

### **Workflow Actions**
- **[Save Draft]** → `status = 'draft'`, auto-saves every 2 mins (TanStack Query)
- **[Request Clarification]** → Opens modal → Sends message to `sales_rep` → Triggers `FR-304`
- **[Submit Review]** → 
  - Validates form
  - Inserts into `internal_reviews`
  - Updates `projects.status = 'review_engineering_submitted'`
  - Triggers notification to Procurement Owner

---

## 🧪 **Zod Schema (TypeScript)**

```ts
// types/engineeringReview.d.ts
import { z } from 'zod';

const riskItemSchema = z.object({
  type: z.enum([
    'material_availability',
    'tolerance_stack_up',
    'surface_finish',
    'part_warpage',
    'tool_wear',
    'assembly_interference',
    'other'
  ]),
  details: z.string().optional()
});

export const engineeringReviewSchema = z.object({
  projectId: z.string().min(1),
  feasibilityStatus: z.enum(['feasible', 'requires_modification', 'not_feasible']),
  modificationNotes: z.string().optional(),
  risks: z.array(riskItemSchema).min(1),
  requiresJig: z.boolean(),
  jigDescription: z.string().optional(),
  requiresSpecialTooling: z.boolean(),
  toolingDetails: z.string().optional(),
  toolingCost: z.number().nonnegative(),
  designImprovements: z.string(),
  alternativeMaterials: z.string(),
  processSuggestions: z.string(),
  attachments: z.array(z.object({
    file: z.instanceof(File).optional(),
    link: z.string().url().optional(),
    type: z.string()
  })).optional(),
  status: z.enum(['draft', 'submitted']),
  reviewerId: z.string().uuid()
});

export type EngineeringReview = z.infer<typeof engineeringReviewSchema>;
```

---

## 📲 **Clarification Request Modal (FR-304)**

```text
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                    Request Design Clarification (Internal)                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

This will notify the Sales/Account Manager to contact the customer.

Subject: [ Design Tolerance Clarification – RFQ-25082001 ]
Message:
[ Please confirm if ±0.05mm tolerance on mounting holes is mandatory. 
  Current capability is ±0.1mm. Can we proceed with relaxed tolerance? ]

Attach: [ design_feedback_v2.pdf ] ✅

[ Cancel ]                                                      [ Send Request → ]
```

> ✉️ **On Send**:  
> - Creates record in `communications` table  
> - Triggers email to assigned `sales_rep`  
> - Updates `projects.status = 'awaiting_customer_clarification'`

---

## 🚀 Next Steps

Would you like me to generate:
- [ ] **QA Team Review Form** (FR-301, Template 3)
- [ ] **Production Planner Review Form**
- [ ] **Supabase SQL migration scripts** for `internal_reviews`, `communications`
- [ ] **React component code** for this form?
- [ ] **Figma component variants** (draft vs submitted state)?

Let me know how you'd like to proceed!